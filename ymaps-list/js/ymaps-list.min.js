"use strict";!function(t,o,e){function i(){return"function"!=typeof o.createElement?o.createElement(arguments[0]):c?o.createElementNS.call(o,"http://www.w3.org/2000/svg",arguments[0]):o.createElement.apply(o,arguments)}var s=[],a={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,o){var e=this;setTimeout(function(){o(e[t])},0)},addTest:function(t,o,e){s.push({name:t,fn:o,options:e})},addAsyncTest:function(t){s.push({name:null,fn:t})}},n=function(){};n.prototype=a,n=new n;var l=[],r=a._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];a._prefixes=r;var p=o.documentElement,c="svg"===p.nodeName.toLowerCase(),h=a.testStyles=function(t,e,s,a){var n,l,r,h,m,d="modernizr",u=i("div"),f=((m=o.body)||((m=i(c?"svg":"body")).fake=!0),m);if(parseInt(s,10))for(;s--;)(r=i("div")).id=a?a[s]:d+(s+1),u.appendChild(r);return(n=i("style")).type="text/css",n.id="s"+d,(f.fake?f:u).appendChild(n),f.appendChild(u),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(o.createTextNode(t)),u.id=d,f.fake&&(f.style.background="",f.style.overflow="hidden",h=p.style.overflow,p.style.overflow="hidden",p.appendChild(f)),l=e(u,t),f.fake?(f.parentNode.removeChild(f),p.style.overflow=h,p.offsetHeight):u.parentNode.removeChild(u),!!l};n.addTest("touchevents",function(){var e;if("ontouchstart"in t||t.DocumentTouch&&o instanceof DocumentTouch)e=!0;else{var i=["@media (",r.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");h(i,function(t){e=9===t.offsetTop})}return e}),function(){var t,o,e,i,a,r;for(var p in s)if(s.hasOwnProperty(p)){if(t=[],(o=s[p]).name&&(t.push(o.name.toLowerCase()),o.options&&o.options.aliases&&o.options.aliases.length))for(e=0;e<o.options.aliases.length;e++)t.push(o.options.aliases[e].toLowerCase());for(i="function"==typeof o.fn?o.fn():o.fn,a=0;a<t.length;a++)1===(r=t[a].split(".")).length?n[r[0]]=i:(!n[r[0]]||n[r[0]]instanceof Boolean||(n[r[0]]=new Boolean(n[r[0]])),n[r[0]][r[1]]=i),l.push((i?"":"no-")+r.join("-"))}}(),delete a.addTest,delete a.addAsyncTest;for(var m=0;m<n._q.length;m++)n._q[m]();t.Modernizr=n}(window,document);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,o){for(var e=0;e<o.length;e++){var i=o[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(o,e,i){return e&&t(o.prototype,e),i&&t(o,i),o}}();function _classCallCheck(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}var Ylist=function(){function t(o){_classCallCheck(this,t),this.options=o,this.map=null,o.hasOwnProperty("data")?this.points=$.extend(!0,[],this.options.data):this.points=null,this.placemarks=[],this.activePlacemark=null,this.activeListItem=null,this.clusterer=null,this.balloonLayout=null,this.balloonParams={balloonWidth:null,balloonHeight:null,balloonTailHeight:15},this.listClassName="ylist-list",this.touch=!!Modernizr.touchevents,this.isLessThanAdaptiveBreakpoint=!1,this.mqlAdaptiveBreakpoint=window.matchMedia("(max-width: "+(this.options.adaptiveBreakpoint-1)+"px)"),this.needReloadMap=!0,this.currentFilterCallback=null,this.currentFilterParam=null}return _createClass(t,[{key:"init",value:function(){var t=this;t._checkRequiredOptions(),ymaps.ready(function(){t.mqlAdaptiveBreakpoint.addListener(function(){t._adaptiveHandle(this,t)}),t._adaptiveHandle(t.mqlAdaptiveBreakpoint,t)}),t.options.list.active&&t._initList()}},{key:"_checkRequiredOptions",value:function(){if(!this.points)throw new Error("You need to JSON data");if(!this.options.hasOwnProperty("dataOrder")||this.options.hasOwnProperty("dataOrder")&&0==this.options.dataOrder.length)throw new Error("You need to set dataOrder option");if(this.options.hasOwnProperty("dataExtension")||(this.options.dataExtension={}),!this.options.hasOwnProperty("container"))throw new Error("You need to set container option");if(this.options.hasOwnProperty("afterInit")||(this.options.afterInit=!1),this.options.hasOwnProperty("map")||(this.options.map={}),this.options.hasOwnProperty("map")&&"object"==_typeof(this.options.map)){if(!this.options.map.hasOwnProperty("center"))throw new Error("You need to set map.center option");if(!this.options.map.hasOwnProperty("container"))throw new Error("You need to set map.container option");this.options.map.hasOwnProperty("customize")||(this.options.map.customize=!1),this.options.map.hasOwnProperty("customize")&&"object"==_typeof(this.options.map.customize)&&(this.options.map.customize.hasOwnProperty("state")||(this.options.map.customize.state=!1),this.options.map.customize.hasOwnProperty("options")||(this.options.map.customize.options={}),this.options.map.customize.hasOwnProperty("controls")||(this.options.map.customize.controls=!1)),this.options.map.hasOwnProperty("drag")||(this.options.map.drag={}),this.options.map.hasOwnProperty("drag")&&"object"==_typeof(this.options.map.drag)&&(this.options.map.drag.hasOwnProperty("disableOnTouch")||(this.options.map.drag.disableOnTouch=!0),this.options.map.drag.hasOwnProperty("disableAlways")||(this.options.map.drag.disableAlways=!1)),this.options.map.hasOwnProperty("dragTooltip")||(this.options.map.dragTooltip={}),this.options.map.hasOwnProperty("dragTooltip")&&"object"==_typeof(this.options.map.dragTooltip)&&(this.options.map.dragTooltip.hasOwnProperty("active")||(this.options.map.dragTooltip.active=!0),this.options.map.dragTooltip.hasOwnProperty("text")||(this.options.map.dragTooltip.text="To drag map touch screen by two fingers and move")),this.options.map.hasOwnProperty("filterTooltip")||(this.options.map.filterTooltip={}),this.options.map.hasOwnProperty("filterTooltip")&&"object"==_typeof(this.options.map.filterTooltip)&&(this.options.map.filterTooltip.hasOwnProperty("active")||(this.options.map.filterTooltip.active=!0),this.options.map.filterTooltip.hasOwnProperty("text")||(this.options.map.filterTooltip.text="No matches found"),this.options.map.filterTooltip.hasOwnProperty("container")||(this.options.map.filterTooltip.container="#"+this.options.container))}if(this.options.hasOwnProperty("list")||(this.options.list={}),this.options.hasOwnProperty("list")&&"object"==_typeof(this.options.list)){if(this.options.list.hasOwnProperty("active")||(this.options.list.active=!1),this.options.list.hasOwnProperty("active")&&this.options.list.active&&!this.options.list.hasOwnProperty("container"))throw new Error("You need to set container option in list");this.options.list.hasOwnProperty("scroll")||(this.options.list.scroll=!1),this.options.list.hasOwnProperty("header")||(this.options.list.header=!0),this.options.list.hasOwnProperty("clickElement")||(this.options.list.clickElement=this.listClassName+"__title"),this.options.list.hasOwnProperty("itemWrapper")||(this.options.list.itemWrapper=!1),this.options.list.hasOwnProperty("modifier")||(this.options.list.modifier="")}this.options.hasOwnProperty("switchContainer")||(this.options.switchContainer=!1),this.options.hasOwnProperty("cluster")||(this.options.cluster={}),this.options.hasOwnProperty("cluster")&&"object"==_typeof(this.options.cluster)&&(this.options.cluster.hasOwnProperty("icons")||(this.options.cluster.icons=["islands#invertedRedClusterIcons","islands#invertedBlueClusterIcons"]),this.options.cluster.hasOwnProperty("inlineStyle")||(this.options.cluster.inlineStyle="")),this.options.hasOwnProperty("placemark")||(this.options.placemark={}),this.options.hasOwnProperty("placemark")&&"object"==_typeof(this.options.placemark)&&(this.options.placemark.hasOwnProperty("icons")||(this.options.placemark.icons=["islands#redDotIcon","islands#blueDotIcon"]),this.options.placemark.hasOwnProperty("clicked")||(this.options.placemark.clicked=!0)),this.options.hasOwnProperty("balloon")||(this.options.balloon={}),this.options.hasOwnProperty("balloon")&&"object"==_typeof(this.options.balloon)&&(this.options.balloon.hasOwnProperty("activeBeforeBreakpoint")||(this.options.balloon.activeBeforeBreakpoint=!1),this.options.balloon.hasOwnProperty("activeAfterBreakpoint")||(this.options.balloon.activeAfterBreakpoint=!1),this.options.balloon.hasOwnProperty("closeButton")||(this.options.balloon.closeButton="x"),this.options.balloon.hasOwnProperty("header")||(this.options.balloon.header=!0),this.options.balloon.hasOwnProperty("mapOverflow")||(this.options.balloon.mapOverflow=!0),this.options.balloon.hasOwnProperty("modifier")||(this.options.balloon.modifier="")),this.options.hasOwnProperty("adaptiveBreakpoint")||(this.options.adaptiveBreakpoint=1024)}},{key:"_initMap",value:function(){var t=this;t.map&&(t.map.destroy(),t.map=null,t.placemarks=[],t.activePlacemark=null,t.clusterer=null,t.balloonLayout=null),t.options.map.dragTooltip.active&&t._initMapDragTooltip();var o={center:t.options.map.center,zoom:13,controls:[]},e=null;"object"==_typeof(t.options.map.customize)&&"object"==_typeof(t.options.map.customize.state)&&(e=t._setMapState(t.options.map.customize.state,o)),t.map=new ymaps.Map(t.options.map.container,e||o,t.options.map.customize.options),"object"==_typeof(t.options.map.customize)&&"object"==_typeof(t.options.map.customize.controls)&&t._setMapControls(t.options.map.customize.controls),t.map.behaviors.disable("scrollZoom"),t._createPlacemarks(),"boolean"!=typeof t.options.cluster||t.options.cluster?(t._createClusterer(),t._addClusterer(),t._setBounds(t.clusterer)):(t._addPlacemarks(),t._setBounds(t.map.geoObjects)),(t.touch&&t.options.map.drag.disableOnTouch||t.options.map.drag.disableAlways)&&t.map.behaviors.disable("drag");var i=t.map.layers.get(0).get(0);t._isReadyMap(i).then(function(){var o=t.options.balloon.activeBeforeBreakpoint,e=t.options.balloon.activeAfterBreakpoint;if(t.activeListItem&&(t.options.placemark.clicked&&o&&t.isLessThanAdaptiveBreakpoint||t.options.placemark.clicked&&e&&!t.isLessThanAdaptiveBreakpoint)&&t._openPlacemarkBalloon(t.activeListItem),"function"==typeof t.options.afterInit){var i=$("#"+t.options.container);t.options.afterInit(i)}}),t.needReloadMap=!1}},{key:"_destroyMap",value:function(){var t=this;t.map&&(t.map.destroy(),t.map=null,t.placemarks=[],t.activePlacemark=null,t.clusterer=null,t.balloonLayout=null)}},{key:"_isReadyMap",value:function(t){return new ymaps.vow.Promise(function(o,e){var i=function(t){for(var o in t)if(t.hasOwnProperty(o)&&(t[o]instanceof ymaps.layer.tileContainer.CanvasContainer||t[o]instanceof ymaps.layer.tileContainer.DomContainer))return t[o];return null}(t),s=!0;i.tiles.each(function(t,o){t.isReady()||(s=!1)}),s?o():i.events.once("ready",function(){o()})})}},{key:"_initList",value:function(){this._createPointsList()}},{key:"_initMapDragTooltip",value:function(){var t=this,o=$("#"+t.options.map.container),e=$('<div class="ylist-drag-tooltip">\n                              <span class="ylist-drag-tooltip__text">'+t.options.map.dragTooltip.text+"</span>\n                          </div>");o.find(".ylist-drag-tooltip").remove(),o.append(e),o.off("touchmove touchstart touchend touchleave touchcancel"),(t.touch&&t.options.map.drag.disableOnTouch||t.options.map.drag.disableAlways)&&o.on("touchmove",function(o){1==o.originalEvent.touches.length?(e.css("opacity","1"),!t.options.balloon.mapOverflow&&t.activePlacemark&&t.activePlacemark.balloon.close()):e.css("opacity","0")}).on("touchstart touchend touchleave touchcancel",function(t){e.css("opacity","0")})}},{key:"_setMapState",value:function(t,o){return Object.assign({},o,t)}},{key:"_setMapControls",value:function(t){var o=this;t.forEach(function(t){var e={};if(!t.hasOwnProperty("constructor"))throw new Error("Нужно указать название метода-конструктора. Например:\nhttps://tech.yandex.ru/maps/doc/jsapi/2.1/ref/reference/control.FullscreenControl-docpage/");e.options=t.options,o.map.controls.add(new ymaps.control[t.constructor](e))})}},{key:"_createPlacemarks",value:function(){for(var t=this,o=0;o<t.points.length;o++){var e=void 0,i=t.options.balloon.activeBeforeBreakpoint,s=t.options.balloon.activeAfterBreakpoint;e=i&&s&&t.options.placemark.clicked||i&&t.isLessThanAdaptiveBreakpoint&&t.options.placemark.clicked||s&&!t.isLessThanAdaptiveBreakpoint&&t.options.placemark.clicked?t._setBalloonData(o):{};var a=t.points[o],n=new ymaps.Placemark(a.coords,e,t._setPlacemarkOptions(o));n.id=a.id,n.events.add("click",function(o){t._placemarkClickHandler(o,t)}),t.activeListItem&&t.activeListItem==a.id&&("string"==typeof t.options.placemark.icons[0]?n.options.set("preset",t.options.placemark.icons[1]):n.options.set("iconImageHref",t.options.placemark.icons[1].href),n.isActive=!0,n.options.set("zIndex",1e3)),t.placemarks.push(n)}}},{key:"_addPlacemarks",value:function(){for(var t=0;t<this.placemarks.length;t++)this.map.geoObjects.add(this.placemarks[t])}},{key:"_openPlacemarkBalloon",value:function(t){for(var o=0;o<this.placemarks.length;o++){var e=this.placemarks[o];if(e.id==t){e.events.fire("click");break}}}},{key:"_setPlacemarkOptions",value:function(t){var o=this,e={},i=o.options.balloon.activeBeforeBreakpoint,s=o.options.balloon.activeAfterBreakpoint;return"string"==typeof o.options.placemark.icons[0]?e.preset=o.options.placemark.icons[0]:(e.iconLayout="default#image",e.iconImageHref=o.options.placemark.icons[0].href,e.iconImageSize=o.options.placemark.icons[0].size,e.iconImageOffset=o.options.placemark.icons[0].offset),(i&&s&&o.options.placemark.clicked||i&&o.isLessThanAdaptiveBreakpoint&&o.options.placemark.clicked||s&&!o.isLessThanAdaptiveBreakpoint&&o.options.placemark.clicked)&&(e.balloonLayout=o._createBalloonLayout(),e.balloonContentLayout=o._createBalloonContentLayout(),e.balloonAutoPan=!1,e.balloonShadow=!1,e.balloonPanelMaxMapArea=0),o.options.placemark.clicked||(e.cursor="default"),e}},{key:"_createClusterer",value:function(){var t=this;if(t.clusterer&&t.clusterer.removeAll(),t.clusterer=new ymaps.Clusterer({groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1,zoomMargin:[80,40,40,40]}),"string"==typeof t.options.cluster.icons[0])t.clusterer.options.set({preset:t.options.cluster.icons[0]});else{var o=ymaps.templateLayoutFactory.createClass('<div style="'+t.options.cluster.inlineStyle+'">{{ properties.geoObjects.length }}</div>');t.clusterer.options.set({clusterIcons:t.options.cluster.icons[0],clusterNumbers:[100],clusterIconContentLayout:o})}t.clusterer.add(t.placemarks)}},{key:"_addClusterer",value:function(){this.map.geoObjects.add(this.clusterer)}},{key:"_createBalloonLayout",value:function(){var t=this;return ymaps.templateLayoutFactory.createClass('<div class="ylist-balloon '+t.options.balloon.modifier+'">\n                <button class="ylist-balloon__close" type="button">'+t.options.balloon.closeButton+'</button>\n                <div class="ylist-balloon__inner">\n                    $[[options.contentLayout]]\n                </div>\n            </div>',{build:function(){this.constructor.superclass.build.call(this),this._$element=$(".ylist-balloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".ylist-balloon__close").on("click",$.proxy(this.onCloseClick,this)),t.balloonParams.balloonWidth=this._$element[0].offsetWidth,t.balloonParams.balloonHeight=this._$element[0].offsetHeight+t.balloonParams.balloonTailHeight},clear:function(){this._$element.find(".ylist-balloon__close").off("click"),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){this.balloonLayout.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},applyElementOffset:function(){this._$element.css({left:-this._$element[0].offsetWidth/2,top:-(this._$element[0].offsetHeight+t.balloonParams.balloonTailHeight)})},onCloseClick:function(t){t.preventDefault(),this.events.fire("userclose")},_isElement:function(t){return t&&t[0]&&t.find(".ylist-balloon__inner")[0]}})}},{key:"_createBalloonContentLayout",value:function(){var t="";return t=!1===this.options.balloon.header?'<div class="ylist-balloon__content">$[properties.balloonContent]</div>':'<h3 class="ylist-balloon__title">$[properties.balloonHeader]</h3>\n                                    <div class="ylist-balloon__content">$[properties.balloonContent]</div>',ymaps.templateLayoutFactory.createClass(t)}},{key:"_setBalloonData",value:function(t){for(var o=this,e="",i="",s=0;s<o.options.dataOrder.length;s++){var a=o.options.dataOrder[s],n="",l="";o.options.dataExtension.hasOwnProperty(a)&&"name"!=a?l=o.options.dataExtension[a](o.points[t][a],o.points[t]):o.options.dataExtension.hasOwnProperty(a)&&"name"==a?n=o.options.dataExtension[a](o.points[t][a],o.points[t]):(n=o.points[t].name,l=o.points[t][a]),e+=n,i+=l}return{balloonHeader:e,balloonContent:i}}},{key:"_setBalloonPane",value:function(t,o,e){e=e||{globalPixelCenter:t.getGlobalPixelCenter(),zoom:t.getZoom()};var i=t.container.getSize(),s=[[e.globalPixelCenter[0]-i[0]/2,e.globalPixelCenter[1]-i[1]/2],[e.globalPixelCenter[0]+i[0]/2,e.globalPixelCenter[1]+i[1]/2]],a=o.balloon.getPosition(),n=Math.pow(2,e.zoom-t.getZoom()),l=ymaps.util.pixelBounds.containsPoint(s,[a[0]*n,a[1]*n]),r="outerBalloon"==o.options.get("balloonPane");!l&&r?o.options.set({balloonPane:"balloon",balloonShadowPane:"shadows"}):l&&!r&&o.options.set({balloonPane:"outerBalloon",balloonShadowPane:"outerBalloon"})}},{key:"_createListElement",value:function(t){var o=this,e=$("<h3/>",{class:o.listClassName+"__title"}),i="",s="",a=$("<li/>",{id:t.id,class:o.listClassName+"__item"});t.name&&o.options.list.header?o.options.dataExtension.hasOwnProperty("name")?e.html(o.options.dataExtension.name(t.name,t)):e.html(t.name):e=null;for(var n=0;n<o.options.dataOrder.length;n++){var l=o.options.dataOrder[n],r="";o.options.dataExtension.hasOwnProperty(l)&&"name"!=l?r=o.options.dataExtension[l](t[l],t):"name"!=l&&(r=t[l]),i+=r}return!1!==o.options.list.itemWrapper?((s=$("<div/>",{class:o.options.list.itemWrapper})).append(e,i),a.append(s)):a.append(e,i),a}},{key:"_createPointsList",value:function(){for(var t=this,o=$("<ul/>",{class:t.listClassName+" "+t.options.list.modifier}),e=0;e<t.points.length;e++){var i=t.points[e];o.append(t._createListElement(i))}$("#"+t.options.list.container).html("").append(o),$(document).on("click","."+t.options.list.clickElement,function(o){var e=$(o.target).closest("."+t.listClassName+"__item").attr("id");if(t.placemarks.length>0)for(var i=0;i<t.placemarks.length;i++){var s=t.placemarks[i];if(s.id==e){t._listItemClickHandler(o,s);break}}else t._listItemClickHandler(o,e)})}},{key:"_setBounds",value:function(t){var o=this;"object"===_typeof(o.placemarks)&&1===o.placemarks.length?o.map.setCenter(o.placemarks[0].geometry.getCoordinates(),16):o.map.setBounds(t.getBounds(),{checkZoomRange:!0,zoomMargin:[80,40,40,40]})}},{key:"_placemarkClickHandler",value:function(t,o){if(this.options.placemark.clicked){var e=t.get("target"),i=o.options.balloon.activeBeforeBreakpoint,s=o.options.balloon.activeAfterBreakpoint;if(o.activePlacemark=e,o._commonClickHandler(e),i&&s||i&&!s&&o.isLessThanAdaptiveBreakpoint||!i&&s&&!o.isLessThanAdaptiveBreakpoint){if(!1===o.options.balloon.mapOverflow){var a=function(t){"outerBalloon"===e.options.get("balloonPane")&&o._setBalloonPane(o.map,e,t.get("tick"))},n=function(t){"outerBalloon"!==e.options.get("balloonPane")&&o._setBalloonPane(o.map,e,t.get("tick"))};o.map.geoObjects.events.add("balloonopen",function(){o.map.events.add("actiontick",a),o.map.events.add("actiontickcomplete",n),o._setBalloonPane(o.map,e)}),o.map.geoObjects.events.add("balloonclose",function(){o.map.events.remove("actiontick",a),o.map.events.remove("actiontickcomplete",n)})}o.map.geoObjects.events.add("balloonopen",function t(){var i,s=void 0,a=!1===o.options.balloon.mapOverflow?4:2;(s=o.map.options.get("projection").toGlobalPixels(e.geometry.getCoordinates(),o.map.getZoom()))[1]-=o.balloonParams.balloonHeight/a,i=o.map.options.get("projection").fromGlobalPixels(s,o.map.getZoom()),o.map.panTo(i,{flying:!0}),o.map.geoObjects.events.remove("balloonopen",t)})}else o.map.panTo(e.geometry.getCoordinates(),{flying:!0})}}},{key:"_listItemClickHandler",value:function(t,o){var e=this;e._commonClickHandler(o);var i=e.options.balloon.activeBeforeBreakpoint,s=e.options.balloon.activeAfterBreakpoint;if("string"!=typeof o){if(e.activePlacemark&&e.map.getZoom()<11){var a=e.clusterer.getObjectState(e.activePlacemark).isClustered,n=e.clusterer.getObjectState(o).isClustered;if(!a&&!n)return e.map.panTo(o.geometry.getCoordinates(),{flying:!0}),e.activePlacemark=o,void(e.options.list.active&&e.options.placemark.clicked&&s&&!e.isLessThanAdaptiveBreakpoint&&o.events.fire("click"))}for(var l=9===e.map.getZoom()?e.map.getZoom():9;e.map.setCenter(o.geometry.getCoordinates(),l++),e.clusterer.getObjectState(o).isClustered;);e.activePlacemark=o,(e.options.placemark.clicked&&i&&s||e.options.placemark.clicked&&i&&!s&&e.isLessThanAdaptiveBreakpoint||e.options.placemark.clicked&&!i&&s&&!e.isLessThanAdaptiveBreakpoint)&&o.events.fire("click")}}},{key:"_commonClickHandler",value:function(t){var o=this,e=null,i=null,s=null,a=o.options.list.active;if(a&&(e=$("#"+o.options.list.container)),"string"==typeof t)a&&(i=$("#"+t)),s=t;else{a&&(i=$("#"+t.id)),s=t.id;for(var n=0;n<o.placemarks.length;n++){var l=o.placemarks[n];"string"==typeof o.options.placemark.icons[0]?l.options.set("preset",o.options.placemark.icons[0]):l.options.set("iconImageHref",o.options.placemark.icons[0].href),l.balloon.close(),o.clusterer.getObjectState(l).cluster&&("string"==typeof o.options.cluster.icons[0]?o.clusterer.getObjectState(l).cluster.options.set("preset",o.options.cluster.icons[0]):o.clusterer.getObjectState(l).cluster.options.set("clusterIcons",o.options.cluster.icons[0])),l.isActive=!1,l.options.set("zIndex",650)}t.options.set("zIndex",1e3),o.clusterer.getObjectState(t).isClustered&&("string"==typeof o.options.cluster.icons[0]?o.clusterer.getObjectState(t).cluster.options.set("preset",o.options.cluster.icons[1]):o.clusterer.getObjectState(t).cluster.options.set("clusterIcons",o.options.cluster.icons[1])),"string"==typeof o.options.placemark.icons[0]?t.options.set("preset",o.options.placemark.icons[1]):t.options.set("iconImageHref",o.options.placemark.icons[1].href),t.isActive=!0}o.activeListItem=s,a&&(e.find("."+o.listClassName+"__item.is-active").removeClass("is-active"),i.addClass("is-active"),"boolean"!=typeof o.options.list.scroll||o.options.list.scroll?o.options.list.scroll(e,i):e.scrollTop(i.position().top+e.scrollTop()))}},{key:"_adaptiveHandle",value:function(t,o){var e=o.options.list.active;t.matches?(o.isLessThanAdaptiveBreakpoint=!0,o.needReloadMap=!0,e&&o._destroyMap(),0!=o.options.switchContainer&&($("#"+o.options.switchContainer).addClass("is-visible"),$("#"+o.options.switchContainer).find('[data-ylist-switch="list"]').addClass("is-active")),e&&$("#"+o.options.map.container).addClass("is-hidden"),$("#"+o.options.map.container).addClass("is-adaptive"),$("#"+o.options.list.container).addClass("is-adaptive"),$("#"+o.options.container).addClass("is-adaptive"),e||o.map||o._initMap(),$(document).on("click","#"+o.options.switchContainer+" [data-ylist-switch]",function(t){o._switchHandler(t,o)})):(o.isLessThanAdaptiveBreakpoint=!1,0!=o.options.switchContainer&&($("#"+o.options.switchContainer).removeClass("is-visible"),$("#"+o.options.switchContainer).find("[data-ylist-switch]").removeClass("is-active")),$("#"+o.options.map.container).removeClass("is-adaptive is-hidden"),$("#"+o.options.list.container).removeClass("is-adaptive is-hidden"),$("#"+o.options.container).removeClass("is-adaptive"),!e&&(e||o.isLessThanAdaptiveBreakpoint||o.map)||(o._initMap(),o.currentFilterCallback&&o.currentFilterParam&&o.filter(o.currentFilterCallback,o.currentFilterParam)),$(document).off("click","#"+o.options.switchContainer+" [data-ylist-switch]",o._switchHandler)),o.map&&(o.touch&&o.options.map.drag.disableOnTouch||o.options.map.drag.disableAlways?o.map.behaviors.disable("drag"):o.map.behaviors.enable("drag"),o.options.map.dragTooltip.active&&o._initMapDragTooltip())}},{key:"_switchHandler",value:function(t,o){var e=$(t.target),i=o.options.balloon.activeBeforeBreakpoint;o.options.balloon.activeAfterBreakpoint;e.length&&!e.hasClass("is-active")&&("map"===e.attr("data-ylist-switch")?($("#"+o.options.map.container).removeClass("is-hidden"),$("#"+o.options.list.container).addClass("is-hidden"),o.needReloadMap?(o._initMap(),o.currentFilterCallback&&o.currentFilterParam&&o.filter(o.currentFilterCallback,o.currentFilterParam)):o.options.list.active&&o.activeListItem&&o.options.placemark.clicked&&i&&o.isLessThanAdaptiveBreakpoint&&o._openPlacemarkBalloon(o.activeListItem)):"list"===e.attr("data-ylist-switch")&&($("#"+o.options.map.container).addClass("is-hidden"),$("#"+o.options.list.container).removeClass("is-hidden")),$("#"+o.options.switchContainer+" [data-ylist-switch]").removeClass("is-active"),e.addClass("is-active"))}},{key:"filter",value:function(t,o){if("function"!=typeof t)throw new TypeError("Аргумент должен быть функцией");var e=this;e.currentFilterCallback=t;var i=e.points,s=e.placemarks,a=0,n=e.options.map.filterTooltip.container,l=$('<div class="ylist-filter-tooltip">\n                                    <span class="ylist-filter-tooltip__text">'+e.options.map.filterTooltip.text+"</span>\n                                </div>");if(!e.map||s.length){e.map?s.forEach(function(t){t.options.set("visible",!1),e.clusterer.remove(t),$("#"+t.id).hide()}):$("#"+e.options.list.container+" ."+e.listClassName+"__item").hide();for(var r=0;r<i.length;r++){var p=i[r];t(p,r,i)?(e.map&&(s[r].options.set("visible",!0),e.clusterer.add(s[r])),$("#"+p.id).show(),e.currentFilterParam=o):a++}a==i.length?e.options.map.filterTooltip.active?($(n+" .ylist-filter-tooltip").remove(),$(n).append(l),$(n+" .ylist-filter-tooltip").css("opacity","1")):console.warn(e.options.map.filterTooltip.text):(e.options.map.filterTooltip.active&&$(n+" .ylist-filter-tooltip").remove(),"boolean"!=typeof e.options.cluster||e.options.cluster?e._setBounds(e.clusterer):e._setBounds(e.map.geoObjects))}else console.warn("Невозможно запустить фильтрацию. Массив меток пуст.")}},{key:"clearFilter",value:function(){var t=this,o=t.options.map.filterTooltip.container;t.currentFilterCallback=null,t.currentFilterParam=null,t.options.map.filterTooltip.active&&$(o+" .ylist-filter-tooltip").remove();for(var e=t.points,i=t.placemarks,s=0;s<e.length;s++)t.map?(i.forEach(function(o){o.options.set("visible",!0),t.clusterer.add(o),$("#"+o.id).show()}),"boolean"!=typeof t.options.cluster||t.options.cluster?t._setBounds(t.clusterer):t._setBounds(t.map.geoObjects)):$("#"+t.options.list.container+" ."+t.listClassName+"__item").show()}},{key:"getPointData",value:function(t){var o=null,e=this.points;t=t.replace(/^#/,"");for(var i=0;i<e.length;i++)if(e[i].id===t){o=e[i];break}return o}},{key:"update",value:function(t){this._destroyMap(),t&&(this.points=$.extend(!0,[],t)),this.init()}}]),t}();