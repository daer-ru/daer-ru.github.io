"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,o){for(var i=0;i<o.length;i++){var s=o[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(o,i,s){return i&&t(o.prototype,i),s&&t(o,s),o}}();function _classCallCheck(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}var Ylist=function(){function t(o){_classCallCheck(this,t),this.options=o,this.map=null,o.hasOwnProperty("data")?this.points=this.options.data:this.points=null,this.placemarks=[],this.activePlacemark=null,this.activeListItem=null,this.clusterer=null,this.balloonLayout=null,this.balloonParams={balloonWidth:null,balloonHeight:null,balloonTailHeight:15},this.listClassName="ylist-list",this.isLessThanAdaptiveBreakpoint=!1,this.mqlAdaptiveBreakpoint=window.matchMedia("(max-width: "+(this.options.adaptiveBreakpoint-1)+"px)"),this.needReloadMap=!0,this.currentFilterCallback=null,this.currentFilterParam=null}return _createClass(t,[{key:"init",value:function(){this._checkRequiredOptions();var t=this;ymaps.ready(function(){t.mqlAdaptiveBreakpoint.addListener(function(){t._adaptiveHandle(this,t)}),t._adaptiveHandle(t.mqlAdaptiveBreakpoint,t)}),this.options.list.active&&this._initList()}},{key:"_checkRequiredOptions",value:function(){if(!this.points)throw new Error("You need to JSON data");if(!this.options.hasOwnProperty("dataOrder")||this.options.hasOwnProperty("dataOrder")&&0==this.options.dataOrder.length)throw new Error("You need to set dataOrder option");if(this.options.hasOwnProperty("dataExtension")||(this.options.dataExtension={}),!this.options.hasOwnProperty("container"))throw new Error("You need to set container option");if(this.options.hasOwnProperty("map")||(this.options.map={}),this.options.hasOwnProperty("map")&&"object"==_typeof(this.options.map)){if(!this.options.map.hasOwnProperty("center"))throw new Error("You need to set map.center option");if(!this.options.map.hasOwnProperty("container"))throw new Error("You need to set map.container option");this.options.map.hasOwnProperty("customize")||(this.options.map.customize=!1),this.options.map.hasOwnProperty("customize")&&"object"==_typeof(this.options.map.customize)&&(this.options.map.customize.hasOwnProperty("state")||(this.options.map.customize.state=!1),this.options.map.customize.hasOwnProperty("options")||(this.options.map.customize.options={}),this.options.map.customize.hasOwnProperty("controls")||(this.options.map.customize.controls=!1)),this.options.map.hasOwnProperty("drag")||(this.options.map.drag={}),this.options.map.hasOwnProperty("drag")&&"object"==_typeof(this.options.map.drag)&&(this.options.map.drag.hasOwnProperty("disableBeforeBreakpoint")||(this.options.map.drag.disableBeforeBreakpoint=!0),this.options.map.drag.hasOwnProperty("disableAfterBreakpoint")||(this.options.map.drag.disableAfterBreakpoint=!1)),this.options.map.hasOwnProperty("dragTooltip")||(this.options.map.dragTooltip={}),this.options.map.hasOwnProperty("dragTooltip")&&"object"==_typeof(this.options.map.dragTooltip)&&(this.options.map.dragTooltip.hasOwnProperty("active")||(this.options.map.dragTooltip.active=!0),this.options.map.dragTooltip.hasOwnProperty("text")||(this.options.map.dragTooltip.text="To drag map touch screen by two fingers and move")),this.options.map.hasOwnProperty("filterTooltip")||(this.options.map.filterTooltip={}),this.options.map.hasOwnProperty("filterTooltip")&&"object"==_typeof(this.options.map.filterTooltip)&&(this.options.map.filterTooltip.hasOwnProperty("active")||(this.options.map.filterTooltip.active=!0),this.options.map.filterTooltip.hasOwnProperty("text")||(this.options.map.filterTooltip.text="No matches found"))}if(this.options.hasOwnProperty("list")||(this.options.list={}),this.options.hasOwnProperty("list")&&"object"==_typeof(this.options.list)){if(this.options.list.hasOwnProperty("active")||(this.options.list.active=!1),this.options.list.hasOwnProperty("active")&&this.options.list.active&&!this.options.list.hasOwnProperty("container"))throw new Error("You need to set container option in list");this.options.list.hasOwnProperty("scroll")||(this.options.list.scroll=!1),this.options.list.hasOwnProperty("header")||(this.options.list.header=!0),this.options.list.hasOwnProperty("clickElement")||(this.options.list.clickElement=this.listClassName+"__title"),this.options.list.hasOwnProperty("itemWrapper")||(this.options.list.itemWrapper=!1),this.options.list.hasOwnProperty("modifier")||(this.options.list.modifier="")}this.options.hasOwnProperty("switchContainer")||(this.options.switchContainer=!1),this.options.hasOwnProperty("cluster")||(this.options.cluster={}),this.options.hasOwnProperty("cluster")&&"object"==_typeof(this.options.cluster)&&(this.options.cluster.hasOwnProperty("icons")||(this.options.cluster.icons=["islands#invertedRedClusterIcons","islands#invertedBlueClusterIcons"]),this.options.cluster.hasOwnProperty("inlineStyle")||(this.options.cluster.inlineStyle="")),this.options.hasOwnProperty("placemark")||(this.options.placemark={}),this.options.hasOwnProperty("placemark")&&"object"==_typeof(this.options.placemark)&&(this.options.placemark.hasOwnProperty("icons")||(this.options.placemark.icons=["islands#redDotIcon","islands#blueDotIcon"]),this.options.placemark.hasOwnProperty("clicked")||(this.options.placemark.clicked=!0)),this.options.hasOwnProperty("balloon")||(this.options.balloon={}),this.options.hasOwnProperty("balloon")&&"object"==_typeof(this.options.balloon)&&(this.options.balloon.hasOwnProperty("activeBeforeBreakpoint")||(this.options.balloon.activeBeforeBreakpoint=!1),this.options.balloon.hasOwnProperty("activeAfterBreakpoint")||(this.options.balloon.activeAfterBreakpoint=!1),this.options.balloon.hasOwnProperty("closeButton")||(this.options.balloon.closeButton="x"),this.options.balloon.hasOwnProperty("header")||(this.options.balloon.header=!0),this.options.balloon.hasOwnProperty("mapOverflow")||(this.options.balloon.mapOverflow=!0),this.options.balloon.hasOwnProperty("modifier")||(this.options.balloon.modifier="")),this.options.hasOwnProperty("adaptiveBreakpoint")||(this.options.adaptiveBreakpoint=1024)}},{key:"_initMap",value:function(){var t=this;this.map&&(this.map.destroy(),this.map=null,this.placemarks=[],this.activePlacemark=null,this.clusterer=null,this.balloonLayout=null),this.options.map.dragTooltip.active&&this._initMapDragTooltip();var o={center:this.options.map.center,zoom:13,controls:[]},i=null;"object"==_typeof(this.options.map.customize)&&"object"==_typeof(this.options.map.customize.state)&&(i=this._setMapState(this.options.map.customize.state,o)),this.map=new ymaps.Map(this.options.map.container,i||o,this.options.map.customize.options),"object"==_typeof(this.options.map.customize)&&"object"==_typeof(this.options.map.customize.controls)&&this._setMapControls(this.options.map.customize.controls),this.map.behaviors.disable("scrollZoom"),this._createPlacemarks(),"boolean"!=typeof this.options.cluster||this.options.cluster?(this._createClusterer(),this._addClusterer(),this._setBounds(this.clusterer)):(this._addPlacemarks(),this._setBounds(this.map.geoObjects)),(this.isLessThanAdaptiveBreakpoint&&this.options.map.drag.disableBeforeBreakpoint||!this.isLessThanAdaptiveBreakpoint&&this.options.map.drag.disableAfterBreakpoint)&&this.map.behaviors.disable("drag");var s=this.map.layers.get(0).get(0);this._isReadyMap(s).then(function(){var o=t.options.balloon.activeBeforeBreakpoint,i=t.options.balloon.activeAfterBreakpoint;t.activeListItem&&(t.options.placemark.clicked&&o&&t.isLessThanAdaptiveBreakpoint||t.options.placemark.clicked&&i&&!t.isLessThanAdaptiveBreakpoint)&&t._openPlacemarkBalloon(t.activeListItem)}),this.needReloadMap=!1}},{key:"_destroyMap",value:function(){this.map&&(this.map.destroy(),this.map=null,this.placemarks=[],this.activePlacemark=null,this.clusterer=null,this.balloonLayout=null)}},{key:"_isReadyMap",value:function(t){return new ymaps.vow.Promise(function(o,i){var s=function(t){for(var o in t)if(t.hasOwnProperty(o)&&(t[o]instanceof ymaps.layer.tileContainer.CanvasContainer||t[o]instanceof ymaps.layer.tileContainer.DomContainer))return t[o];return null}(t),e=!0;s.tiles.each(function(t,o){t.isReady()||(e=!1)}),e?o():s.events.once("ready",function(){o()})})}},{key:"_initList",value:function(){this._createPointsList()}},{key:"_initMapDragTooltip",value:function(){var t=this,o=$("#"+this.options.map.container),i=$('<div class="ylist-drag-tooltip">\n                              <span class="ylist-drag-tooltip__text">'+this.options.map.dragTooltip.text+"</span>\n                          </div>");o.find(".ylist-drag-tooltip").remove(),o.append(i),o.off("touchmove touchstart touchend touchleave touchcancel"),this.isLessThanAdaptiveBreakpoint&&this.options.map.drag.disableBeforeBreakpoint&&o.on("touchmove",function(o){1==o.originalEvent.touches.length?(i.css("opacity","1"),!t.options.balloon.mapOverflow&&t.activePlacemark&&t.activePlacemark.balloon.close()):i.css("opacity","0")}).on("touchstart touchend touchleave touchcancel",function(t){i.css("opacity","0")})}},{key:"_setMapState",value:function(t,o){return Object.assign({},o,t)}},{key:"_setMapControls",value:function(t){var o=this;t.forEach(function(t){var i={};if(!t.hasOwnProperty("constructor"))throw new Error("Нужно указать название метода-конструктора. Например:\nhttps://tech.yandex.ru/maps/doc/jsapi/2.1/ref/reference/control.FullscreenControl-docpage/");i.options=t.options,o.map.controls.add(new ymaps.control[t.constructor](i))})}},{key:"_createPlacemarks",value:function(){for(var t=this,o=0;o<this.points.length;o++){var i=void 0,s=this.options.balloon.activeBeforeBreakpoint,e=this.options.balloon.activeAfterBreakpoint;i=s&&e&&this.options.placemark.clicked||s&&this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked||e&&!this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked?this._setBalloonData(o):{};var a=this.points[o],n=new ymaps.Placemark(a.coords,i,this._setPlacemarkOptions(o));n.id=a.id,n.events.add("click",function(o){t._placemarkClickHandler(o,t)}),this.activeListItem&&this.activeListItem==a.id&&("string"==typeof this.options.placemark.icons[0]?n.options.set("preset",this.options.placemark.icons[1]):n.options.set("iconImageHref",this.options.placemark.icons[1].href),n.isActive=!0),this.placemarks.push(n)}}},{key:"_addPlacemarks",value:function(){for(var t=0;t<this.placemarks.length;t++)this.map.geoObjects.add(this.placemarks[t])}},{key:"_openPlacemarkBalloon",value:function(t){for(var o=0;o<this.placemarks.length;o++){var i=this.placemarks[o];if(i.id==t){i.events.fire("click");break}}}},{key:"_setPlacemarkOptions",value:function(t){var o={},i=this.options.balloon.activeBeforeBreakpoint,s=this.options.balloon.activeAfterBreakpoint;return"string"==typeof this.options.placemark.icons[0]?o.preset=this.options.placemark.icons[0]:(o.iconLayout="default#image",o.iconImageHref=this.options.placemark.icons[0].href,o.iconImageSize=this.options.placemark.icons[0].size,o.iconImageOffset=this.options.placemark.icons[0].offset),(i&&s&&this.options.placemark.clicked||i&&this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked||s&&!this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked)&&(o.balloonLayout=this._createBalloonLayout(),o.balloonContentLayout=this._createBalloonContentLayout(),o.balloonAutoPan=!1,o.balloonShadow=!1,o.balloonPanelMaxMapArea=0),this.options.placemark.clicked||(o.cursor="default"),o}},{key:"_createClusterer",value:function(){if(this.clusterer&&this.clusterer.removeAll(),this.clusterer=new ymaps.Clusterer({groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1,zoomMargin:40}),"string"==typeof this.options.cluster.icons[0])this.clusterer.options.set({preset:this.options.cluster.icons[0]});else{var t=ymaps.templateLayoutFactory.createClass('<div style="'+this.options.cluster.inlineStyle+'">{{ properties.geoObjects.length }}</div>');this.clusterer.options.set({clusterIcons:this.options.cluster.icons[0],clusterNumbers:[100],clusterIconContentLayout:t})}this.clusterer.add(this.placemarks)}},{key:"_addClusterer",value:function(){this.map.geoObjects.add(this.clusterer)}},{key:"_createBalloonLayout",value:function(){var t=this;return ymaps.templateLayoutFactory.createClass('<div class="ylist-balloon '+this.options.balloon.modifier+'">\n                <button class="ylist-balloon__close" type="button">'+this.options.balloon.closeButton+'</button>\n                <div class="ylist-balloon__inner">\n                    $[[options.contentLayout]]\n                </div>\n            </div>',{build:function(){this.constructor.superclass.build.call(this),this._$element=$(".ylist-balloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".ylist-balloon__close").on("click",$.proxy(this.onCloseClick,this)),t.balloonParams.balloonWidth=this._$element[0].offsetWidth,t.balloonParams.balloonHeight=this._$element[0].offsetHeight+t.balloonParams.balloonTailHeight},clear:function(){this._$element.find(".ylist-balloon__close").off("click"),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){this.balloonLayout.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},applyElementOffset:function(){this._$element.css({left:-this._$element[0].offsetWidth/2,top:-(this._$element[0].offsetHeight+t.balloonParams.balloonTailHeight)})},onCloseClick:function(t){t.preventDefault(),this.events.fire("userclose")},_isElement:function(t){return t&&t[0]&&t.find(".ylist-balloon__inner")[0]}})}},{key:"_createBalloonContentLayout",value:function(){var t="";return t=!1===this.options.balloon.header?'<div class="ylist-balloon__content">$[properties.balloonContent]</div>':'<h3 class="ylist-balloon__title">$[properties.balloonHeader]</h3>\n                                    <div class="ylist-balloon__content">$[properties.balloonContent]</div>',ymaps.templateLayoutFactory.createClass(t)}},{key:"_setBalloonData",value:function(t){for(var o="",i="",s=0;s<this.options.dataOrder.length;s++){var e=this.options.dataOrder[s],a="",n="";this.options.dataExtension.hasOwnProperty(e)&&"name"!=e?n=this.options.dataExtension[e](this.points[t][e],this.points[t]):this.options.dataExtension.hasOwnProperty(e)&&"name"==e?a=this.options.dataExtension[e](this.points[t][e],this.points[t]):(a=this.points[t].name,n=this.points[t][e]),o+=a,i+=n}return{balloonHeader:o,balloonContent:i}}},{key:"_setBalloonPane",value:function(t,o,i){i=i||{globalPixelCenter:t.getGlobalPixelCenter(),zoom:t.getZoom()};var s=t.container.getSize(),e=[[i.globalPixelCenter[0]-s[0]/2,i.globalPixelCenter[1]-s[1]/2],[i.globalPixelCenter[0]+s[0]/2,i.globalPixelCenter[1]+s[1]/2]],a=o.balloon.getPosition(),n=Math.pow(2,i.zoom-t.getZoom()),l=ymaps.util.pixelBounds.containsPoint(e,[a[0]*n,a[1]*n]),r="outerBalloon"==o.options.get("balloonPane");!l&&r?o.options.set({balloonPane:"balloon",balloonShadowPane:"shadows"}):l&&!r&&o.options.set({balloonPane:"outerBalloon",balloonShadowPane:"outerBalloon"})}},{key:"_createListElement",value:function(t){var o=$("<h3/>",{class:this.listClassName+"__title"}),i="",s="",e=$("<li/>",{id:t.id,class:this.listClassName+"__item"});t.name&&this.options.list.header?this.options.dataExtension.hasOwnProperty("name")?o.html(this.options.dataExtension.name(t.name,t)):o.html(t.name):o=null;for(var a=0;a<this.options.dataOrder.length;a++){var n=this.options.dataOrder[a],l="";this.options.dataExtension.hasOwnProperty(n)&&"name"!=n?l=this.options.dataExtension[n](t[n],t):"name"!=n&&(l=t[n]),i+=l}return!1!==this.options.list.itemWrapper?((s=$("<div/>",{class:this.options.list.itemWrapper})).append(o,i),e.append(s)):e.append(o,i),e}},{key:"_createPointsList",value:function(){for(var t=this,o=$("<ul/>",{class:this.listClassName+" "+this.options.list.modifier}),i=0;i<this.points.length;i++){var s=this.points[i];o.append(this._createListElement(s))}$("#"+this.options.list.container).html("").append(o),$(document).on("click","."+t.options.list.clickElement,function(o){var i=$(this).closest("."+t.listClassName+"__item").attr("id");if(t.placemarks.length>0)for(var s=0;s<t.placemarks.length;s++){var e=t.placemarks[s];if(e.id==i){t._listItemClickHandler(o,e);break}}else t._listItemClickHandler(o,i)})}},{key:"_setBounds",value:function(t){"object"===_typeof(this.placemarks)&&1===this.placemarks.length?this.map.setCenter(this.placemarks[0].geometry.getCoordinates(),16):this.map.setBounds(t.getBounds(),{checkZoomRange:!0,zoomMargin:10})}},{key:"_placemarkClickHandler",value:function(t,o){if(this.options.placemark.clicked){var i=t.get("target"),s=this.options.balloon.activeBeforeBreakpoint,e=this.options.balloon.activeAfterBreakpoint;if(o.activePlacemark=i,this._commonClickHandler(i),s&&e||s&&!e&&this.isLessThanAdaptiveBreakpoint||!s&&e&&!this.isLessThanAdaptiveBreakpoint){if(!1===this.options.balloon.mapOverflow){var a=function(t){"outerBalloon"===i.options.get("balloonPane")&&o._setBalloonPane(o.map,i,t.get("tick"))},n=function(t){"outerBalloon"!==i.options.get("balloonPane")&&o._setBalloonPane(o.map,i,t.get("tick"))};o.map.geoObjects.events.add("balloonopen",function(){o.map.events.add("actiontick",a),o.map.events.add("actiontickcomplete",n),o._setBalloonPane(o.map,i)}),o.map.geoObjects.events.add("balloonclose",function(){o.map.events.remove("actiontick",a),o.map.events.remove("actiontickcomplete",n)})}o.map.geoObjects.events.add("balloonopen",function t(){var s,e=void 0,a=!1===o.options.balloon.mapOverflow?4:2;(e=o.map.options.get("projection").toGlobalPixels(i.geometry.getCoordinates(),o.map.getZoom()))[1]-=o.balloonParams.balloonHeight/a,s=o.map.options.get("projection").fromGlobalPixels(e,o.map.getZoom()),o.map.panTo(s,{flying:!0}),o.map.geoObjects.events.remove("balloonopen",t)})}else o.map.panTo(i.geometry.getCoordinates(),{flying:!0})}}},{key:"_listItemClickHandler",value:function(t,o){this._commonClickHandler(o);var i=this.options.balloon.activeBeforeBreakpoint,s=this.options.balloon.activeAfterBreakpoint;if("string"!=typeof o){if(this.activePlacemark&&this.map.getZoom()<11){var e=this.clusterer.getObjectState(this.activePlacemark).isClustered,a=this.clusterer.getObjectState(o).isClustered;if(!e&&!a)return this.map.panTo(o.geometry.getCoordinates(),{flying:!0}),this.activePlacemark=o,void(this.options.list.active&&this.options.placemark.clicked&&s&&!this.isLessThanAdaptiveBreakpoint&&o.events.fire("click"))}for(var n=9===this.map.getZoom()?this.map.getZoom():9;this.map.setCenter(o.geometry.getCoordinates(),n++),this.clusterer.getObjectState(o).isClustered;);this.activePlacemark=o,(this.options.placemark.clicked&&i&&s||this.options.placemark.clicked&&i&&!s&&this.isLessThanAdaptiveBreakpoint||this.options.placemark.clicked&&!i&&s&&!this.isLessThanAdaptiveBreakpoint)&&o.events.fire("click")}}},{key:"_commonClickHandler",value:function(t){var o=null,i=null,s=null,e=this.options.list.active;if(e&&(o=$("#"+this.options.list.container)),"string"==typeof t)e&&(i=$("#"+t)),s=t;else{e&&(i=$("#"+t.id)),s=t.id;for(var a=0;a<this.placemarks.length;a++){var n=this.placemarks[a];"string"==typeof this.options.placemark.icons[0]?n.options.set("preset",this.options.placemark.icons[0]):n.options.set("iconImageHref",this.options.placemark.icons[0].href),n.balloon.close(),this.clusterer.getObjectState(n).cluster&&("string"==typeof this.options.cluster.icons[0]?this.clusterer.getObjectState(n).cluster.options.set("preset",this.options.cluster.icons[0]):this.clusterer.getObjectState(n).cluster.options.set("clusterIcons",this.options.cluster.icons[0])),n.isActive=!1}this.clusterer.getObjectState(t).isClustered&&("string"==typeof this.options.cluster.icons[0]?this.clusterer.getObjectState(t).cluster.options.set("preset",this.options.cluster.icons[1]):this.clusterer.getObjectState(t).cluster.options.set("clusterIcons",this.options.cluster.icons[1])),"string"==typeof this.options.placemark.icons[0]?t.options.set("preset",this.options.placemark.icons[1]):t.options.set("iconImageHref",this.options.placemark.icons[1].href),t.isActive=!0}this.activeListItem=s,e&&(o.find("."+this.listClassName+"__item.is-active").removeClass("is-active"),i.addClass("is-active"),"boolean"!=typeof this.options.list.scroll||this.options.list.scroll?this.options.list.scroll(o,i):o.scrollTop(i.position().top+o.scrollTop()))}},{key:"_adaptiveHandle",value:function(t,o){var i=o.options.list.active;t.matches?(o.isLessThanAdaptiveBreakpoint=!0,o.needReloadMap=!0,i&&o._destroyMap(),0!=o.options.switchContainer&&($("#"+o.options.switchContainer).addClass("is-visible"),$("#"+o.options.switchContainer).find('[data-ylist-switch="list"]').addClass("is-active")),i&&$("#"+o.options.map.container).addClass("is-hidden"),$("#"+o.options.map.container).addClass("is-adaptive"),$("#"+o.options.list.container).addClass("is-adaptive"),$("#"+o.options.container).addClass("is-adaptive"),i||o.map||o._initMap(),!i&&o.map&&(o.options.map.drag.disableBeforeBreakpoint?o.map.behaviors.disable("drag"):o.map.behaviors.enable("drag"),this.options.map.dragTooltip.active&&this._initMapDragTooltip()),$(document).on("click","#"+o.options.switchContainer+" [data-ylist-switch]",function(t){o._switchHandler(t,o)})):(o.isLessThanAdaptiveBreakpoint=!1,0!=o.options.switchContainer&&($("#"+o.options.switchContainer).removeClass("is-visible"),$("#"+o.options.switchContainer).find("[data-ylist-switch]").removeClass("is-active")),$("#"+o.options.map.container).removeClass("is-adaptive is-hidden"),$("#"+o.options.list.container).removeClass("is-adaptive is-hidden"),$("#"+o.options.container).removeClass("is-adaptive"),!i&&(i||o.isLessThanAdaptiveBreakpoint||o.map)||(o._initMap(),this.currentFilterCallback&&this.currentFilterParam&&o.filter(this.currentFilterCallback,this.currentFilterParam)),!i&&o.map&&(o.options.map.drag.disableAfterBreakpoint?o.map.behaviors.disable("drag"):o.map.behaviors.enable("drag"),this.options.map.dragTooltip.active&&this._initMapDragTooltip()),$(document).off("click","#"+o.options.switchContainer+" [data-ylist-switch]",o._switchHandler))}},{key:"_switchHandler",value:function(t,o){var i=$(t.target),s=this.options.balloon.activeBeforeBreakpoint;this.options.balloon.activeAfterBreakpoint;i.length&&!i.hasClass("is-active")&&("map"===i.attr("data-ylist-switch")?($("#"+o.options.map.container).removeClass("is-hidden"),$("#"+o.options.list.container).addClass("is-hidden"),o.needReloadMap?(o._initMap(),this.currentFilterCallback&&this.currentFilterParam&&o.filter(this.currentFilterCallback,this.currentFilterParam)):o.options.list.active&&o.activeListItem&&o.options.placemark.clicked&&s&&o.isLessThanAdaptiveBreakpoint&&o._openPlacemarkBalloon(o.activeListItem)):"list"===i.attr("data-ylist-switch")&&($("#"+o.options.map.container).addClass("is-hidden"),$("#"+o.options.list.container).removeClass("is-hidden")),$("#"+o.options.switchContainer+" [data-ylist-switch]").removeClass("is-active"),i.addClass("is-active"))}},{key:"filter",value:function(t,o){var i=this;if("function"!=typeof t)throw new TypeError("Аргумент должен быть функцией");this.currentFilterCallback=t;var s=this.points,e=this.placemarks,a=0,n=$('<div class="ylist-filter-tooltip">\n                                    <span class="ylist-filter-tooltip__text">'+this.options.map.filterTooltip.text+"</span>\n                                </div>");if(!this.map||e.length){this.map?e.forEach(function(t){t.options.set("visible",!1),i.clusterer.remove(t),$("#"+t.id).hide()}):$("#"+this.options.list.container+" ."+this.listClassName+"__item").hide();for(var l=0;l<s.length;l++){var r=s[l];t(r,l,s)?(this.map&&(e[l].options.set("visible",!0),this.clusterer.add(e[l])),$("#"+r.id).show(),this.currentFilterParam=o):a++}a==s.length?this.options.map.filterTooltip.active?($("#"+this.options.container+" .ylist-filter-tooltip").remove(),$("#"+this.options.container).append(n),$("#"+this.options.container+" .ylist-filter-tooltip").css("opacity","1")):console.warn(this.options.map.filterTooltip.text):(this.options.map.filterTooltip.active&&$("#"+this.options.container+" .ylist-filter-tooltip").remove(),"boolean"!=typeof this.options.cluster||this.options.cluster?this._setBounds(this.clusterer):this._setBounds(this.map.geoObjects))}else console.warn("Невозможно запустить фильтрацию. Массив меток пуст.")}},{key:"clearFilter",value:function(){var t=this;this.currentFilterCallback=null,this.currentFilterParam=null,this.options.map.filterTooltip.active&&$("#"+this.options.container+" .ylist-filter-tooltip").remove();for(var o=this.points,i=this.placemarks,s=0;s<o.length;s++)this.map?(i.forEach(function(o){o.options.set("visible",!0),t.clusterer.add(o),$("#"+o.id).show()}),"boolean"!=typeof this.options.cluster||this.options.cluster?this._setBounds(this.clusterer):this._setBounds(this.map.geoObjects)):$("#"+this.options.list.container+" ."+this.listClassName+"__item").show()}}]),t}();